{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _excluded = [\"pointerEvents\", \"children\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport { Platform } from 'expo-modules-core';\nimport * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport PixelRatio from \"react-native-web/dist/exports/PixelRatio\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport createElement from 'react-native-web/dist/exports/createElement';\n\nfunction getElement(component) {\n  try {\n    return findDOMNode(component);\n  } catch (_unused) {\n    return component;\n  }\n}\n\nfunction setRef(refProp, ref) {\n  if (!refProp) return;\n\n  if (typeof refProp === 'function') {\n    refProp(ref);\n  } else if ('current' in refProp) {\n    refProp.current = ref;\n  }\n}\n\nvar Canvas = React.forwardRef(function (props, ref) {\n  return createElement('canvas', _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref\n  }));\n});\n\nvar CanvasWrapper = function CanvasWrapper(_ref) {\n  var pointerEvents = _ref.pointerEvents,\n      children = _ref.children,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  var _React$useState = React.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      size = _React$useState2[0],\n      setSize = _React$useState2[1];\n\n  var ref = React.useRef(null);\n\n  var _canvasRef = React.useRef(null);\n\n  function updateCanvasSize() {\n    var canvas = _canvasRef.current;\n\n    if (typeof HTMLCanvasElement !== 'undefined' && canvas instanceof HTMLCanvasElement) {\n      var _size = getSize();\n\n      var scale = PixelRatio.get();\n      canvas.style.width = _size.width + \"px\";\n      canvas.style.height = _size.height + \"px\";\n      canvas.width = _size.width * scale;\n      canvas.height = _size.height * scale;\n    }\n  }\n\n  function getSize() {\n    if (size) {\n      return size;\n    } else if (!ref.current || !Platform.isDOMAvailable) {\n      return {\n        width: 0,\n        height: 0\n      };\n    }\n\n    var element = getElement(ref.current);\n    var _element$offsetWidth = element.offsetWidth,\n        width = _element$offsetWidth === void 0 ? 0 : _element$offsetWidth,\n        _element$offsetHeight = element.offsetHeight,\n        height = _element$offsetHeight === void 0 ? 0 : _element$offsetHeight;\n    return {\n      width: width,\n      height: height\n    };\n  }\n\n  var onLayout = function onLayout(event) {\n    var _event$nativeEvent$la = event.nativeEvent.layout,\n        width = _event$nativeEvent$la.width,\n        height = _event$nativeEvent$la.height;\n\n    if (width !== (size == null ? void 0 : size.width) || height !== size.height) {\n      setSize({\n        width: width,\n        height: height\n      });\n\n      if (props.onLayout) {\n        props.onLayout(event);\n      }\n    }\n  };\n\n  React.useEffect(function () {\n    if (ref.current != null) {\n      setSize(getSize());\n    }\n  }, [ref]);\n  React.useEffect(function () {\n    updateCanvasSize();\n  }, [size]);\n  React.useEffect(function () {\n    var canvas = _canvasRef.current;\n\n    if (canvas) {\n      updateCanvasSize();\n    }\n\n    setRef(props.canvasRef, canvas);\n  }, [_canvasRef]);\n  return React.createElement(View, _objectSpread(_objectSpread({}, props), {}, {\n    pointerEvents: \"box-none\",\n    ref: ref,\n    onLayout: onLayout\n  }), React.createElement(Canvas, {\n    ref: _canvasRef,\n    pointerEvents: pointerEvents,\n    style: StyleSheet.absoluteFill\n  }), children);\n};\n\nexport default CanvasWrapper;","map":{"version":3,"sources":["../src/Canvas.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Platform } from 'expo-modules-core';\nimport * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { LayoutChangeEvent, PixelRatio, StyleSheet, View, ViewProps } from 'react-native';\nimport createElement from 'react-native-web/dist/exports/createElement';\n\nfunction getElement(component) {\n  try {\n    return findDOMNode(component);\n  } catch {\n    return component;\n  }\n}\n\nfunction setRef<T>(refProp: React.Ref<T>, ref: T | null) {\n  if (!refProp) return;\n\n  if (typeof refProp === 'function') {\n    refProp(ref);\n  } else if ('current' in refProp) {\n    // @ts-ignore\n    refProp.current = ref;\n  }\n}\n\nconst Canvas = React.forwardRef(\n  (props: React.ComponentProps<typeof View>, ref: React.Ref<HTMLCanvasElement>) =>\n    createElement('canvas', { ...props, ref })\n);\n\nconst CanvasWrapper: React.FunctionComponent<\n  ViewProps & {\n    canvasRef: React.Ref<HTMLCanvasElement>;\n  }\n> = ({ pointerEvents, children, ...props }) => {\n  const [size, setSize] = React.useState<{ width: number; height: number } | null>(null);\n\n  const ref = React.useRef<View>(null);\n  const _canvasRef = React.useRef<HTMLCanvasElement>(null);\n\n  function updateCanvasSize(): void {\n    const canvas = _canvasRef.current;\n    // eslint-disable-next-line no-undef\n    if (typeof HTMLCanvasElement !== 'undefined' && canvas instanceof HTMLCanvasElement) {\n      const size = getSize();\n      const scale = PixelRatio.get();\n\n      canvas.style.width = `${size.width}px`;\n      canvas.style.height = `${size.height}px`;\n\n      canvas.width = size.width * scale;\n      canvas.height = size.height * scale;\n    }\n  }\n\n  function getSize(): { width: number; height: number } {\n    if (size) {\n      return size;\n    } else if (!ref.current || !Platform.isDOMAvailable) {\n      return { width: 0, height: 0 };\n    }\n    const element = getElement(ref.current);\n    const { offsetWidth: width = 0, offsetHeight: height = 0 } = element;\n    return { width, height };\n  }\n\n  const onLayout = (event: LayoutChangeEvent) => {\n    const {\n      nativeEvent: {\n        layout: { width, height },\n      },\n    } = event;\n\n    if (width !== size?.width || height !== size.height) {\n      setSize({ width, height });\n\n      if (props.onLayout) {\n        props.onLayout(event);\n      }\n    }\n  };\n\n  React.useEffect(() => {\n    if (ref.current != null) {\n      setSize(getSize());\n    }\n  }, [ref]);\n\n  React.useEffect(() => {\n    updateCanvasSize();\n  }, [size]);\n\n  React.useEffect(() => {\n    const canvas = _canvasRef.current;\n    if (canvas) {\n      updateCanvasSize();\n    }\n    setRef(props.canvasRef, canvas);\n  }, [_canvasRef]);\n\n  return (\n    <View {...props} pointerEvents=\"box-none\" ref={ref} onLayout={onLayout}>\n      <Canvas ref={_canvasRef} pointerEvents={pointerEvents} style={StyleSheet.absoluteFill} />\n      {children}\n    </View>\n  );\n};\n\nexport default CanvasWrapper;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}